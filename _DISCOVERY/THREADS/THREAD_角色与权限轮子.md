# THREAD：角色与权限轮子（RoleUser Permission）

状态：进行中（目标：讨论清楚后直接做；本 THREAD 用于防止重复沟通与跑偏）

## 0) 目的（给未来的我你）

 做一个“不会大返工”的权限体系：既支持角色模板（方便开通），又支持账号级加减（满足跨部门协作、同角色不同权限）。
 不把权限与部门绑定：超管勾选权限时永远能看到“全量权限树”，跨部门权限也能直接勾。
 权限修改“点保存生效”，并支持开发测试阶段高效验证。

---

## 1) 已冻结（不再反复讨论）

### 1.1 权限模型（Role Template + User Override）

 采用三层叠加的最终权限计算（效果口径）：

  1. 角色模板权限（默认推荐）
  2. 账号额外增加权限（加）
  3. 账号显式禁止权限（减；优先级最高，可覆盖角色模板给的权限）
 角色模板只是“推荐默认”，最终以管理员勾选为准。
 超管给账号勾选权限时：不被部门框死；界面应可见“全量权限树”，允许跨部门勾选。
 无权限的入口按钮：选择 隐藏（更干净）。

### 1.2 生效方式

 权限修改：点保存才生效（避免误操作带来的实时影响）。

### 1.3 开发测试验证方式（两者都要）

 方式 1：同一账号“一键切换角色视角”（快速验证角色默认能看到什么；减少频繁换号）。
 方式 2：测试账号套件（验证“账号加减权限”的真实生效）：

   纯角色账号（只套角色模板）
   叠加账号（额外加权限）
   削减账号（显式禁权限）
   超管账号（可配置）
 建议补充（可选但强烈建议）：超管界面提供“权限预览对比”

   能看到某账号最终权限 = 角色 + 加 - 减
   能对比：相对角色模板多了哪些少了哪些

### 1.4 权限点权限树的演进原则（不要求一次想全）

 权限树先建“稳定骨架”（模块 → 动作，如 查询新建编辑保存删除 等），支持后续持续新增。
 允许后续新增权限点新增模块，不视为返工。
 变更护栏：尽量不改已有权限点的含义；若必须变更，采用“新增替代 + 旧项弃用（保留历史配置不乱）”。

---

## 2) 已提供的实物背景（权威输入）

 平台申请流程规则报告：`_DISCOVERYrulesplatform_application_rules.md`
 平台申请角色权限矩阵 v1（代码事实：当前未接入 RBAC，差异由 stagesourceType + status + 弹窗状态驱动）：

   `_DISCOVERYrulesplatform_application_role_permission_matrix_v1.md`

---

## 3) 未确认（Unknown  下次继续重点）

 以下不允许脑补；需要你明确口径或给实物。

### 3.1 权限树初版覆盖范围

 初版要覆盖哪些模块的权限点（建议从平台申请工单申请类入口开始），再逐步扩展（未确认）。

### 3.2 权限配置责任与留痕

 谁是超管管理员（谁能配置权限）。
 是否必须提供“权限变更记录”（谁在什么时候改了谁的哪些权限）作为强制能力（强烈建议，但是否强制未确认）。

### 3.3 环境策略

 “一键切换角色视角”是否仅限测试环境仅超管可见（未确认）。

---

## 4) 下次继续需要的实物（最省沟通版）

1. 超管管理员名单或规则（谁能配置权限）。
2. 权限点初版清单（可以先只列平台申请相关模块；后续再扩展）。
3. 测试账号套件计划（账号类型与数量；可后补）。

---

## 5) 下次续聊的切入点（避免重复劳动）

 先用“平台申请”作为第一个接入 RBAC 的试点：把入口按钮隐藏与权限勾选打通。
 同步把权限树骨架定下来（模块→动作），确保后续扩展不返工。
 再扩展到工单其他申请入口，
