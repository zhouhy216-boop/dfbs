# THREAD：确认提交与规则提醒轮子（Confirm/Warning Gate）
状态：进行中（目标：讨论清楚后直接做；本 THREAD 用于防止重复沟通与跑偏）

## 0) 目的（给未来的我/你）
- 给“最终提交/通过”类操作增加一层统一的“拦截门（Gate）”：
  - 普通确认：提交前弹框展示关键字段摘要，让填写人二次确认，防误提交。
  - 规则提醒：命中重复/违规/可复用等规则时弹框提示，并给出分支选择（返回编辑/确认新增/申请复用等）。
- 超管可配置：哪些模块/表单/按钮启用 Gate，弹框展示哪些关键信息（字段摘要），且一旦配置为“必须弹”则每次必弹。
- 本轮子只负责“拦截门与弹框”；不负责按钮动作本身（按钮动作由 `THREAD_表单自定义轮子.md` 的动作引擎执行）。

---

## 1) 已冻结（不再反复讨论）
### 1.1 覆盖范围（只覆盖最终提交/通过）
- 仅覆盖“最终提交/通过/发起”这类最终动作。
- 不覆盖“保存草稿/保存/清空”等非最终动作（后续如需要可扩展）。

### 1.2 配置责任（超管配置）
- 由超管配置：
  - 哪些模块/表单/按钮启用 Gate（弹不弹）
  - 启用后展示哪些关键字段摘要（以及顺序）
- 用户侧不提供“我已核对，以后不再提示”（已确认：必须弹则每次必弹）。

### 1.3 Gate 类型（两类 Gate）
A) 提交确认 Gate（Confirm Gate）
- 触发：用户点击最终提交/通过类按钮时（若该按钮挂了 Confirm Gate）。
- 弹框内容：关键字段摘要（由超管勾选配置）。
- 交互：返回编辑 / 确认继续（确认后才会执行按钮动作）。

B) 规则提醒 Gate（Warning Gate）
- 触发：点击最终动作时，命中某些规则（重复、违规、可复用等），或点击动作前需要做一次“规则判定”。
- 弹框内容：命中原因 + 关键字段摘要 +（可选）命中列表/候选项。
- 交互：允许分支按钮（示例来自平台申请的重复提醒弹窗）：
  - 返回编辑
  - 确认新增
  - 申请复用
  - 开卡申请（placeholder）
  - 申请核查（placeholder）
- 注：分支按钮最终仍会回到“动作引擎”执行对应动作/跳转/占位提示。

### 1.4 “必须弹”的规则（已确认）
- 若超管为某按钮配置了 Gate 且标记为“必须弹”，则每次点击该按钮都必须弹 Gate。
- 不允许用户关闭“以后不再提示”。

### 1.5 与按钮动作引擎的关系（接口约束）
- 统一执行链路（效果口径）：
  1) 用户点击按钮
  2) 进入 Gate（若该按钮挂载 Gate，且触发条件满足）
  3) Gate 内用户选择（返回编辑 / 继续 / 走分支）
  4) 通过后回到动作引擎执行真实动作（提交/通过/驳回/跳转等）
- 目的：让“已完成的表单”后期加 Gate 不麻烦（一次接入，全局复用）。

---

## 2) 推荐的配置粒度（成熟默认，避免臃肿）
> 允许按按钮配置，必要时提供默认继承，减少重复配置。

- 模块级默认（可选）：为一个模块定义默认 Gate 与默认摘要字段
- 表单/流程级覆盖（可选）：为某个表单/流程覆盖模块默认
- 按钮级配置（必须）：最终以按钮级为准（最精确、最可控）

---

## 3) 已提供的实物/背景（权威输入）
- 平台申请重复提醒弹窗及其分支（权威输入）：
  - `_DISCOVERY/rules/platform_application_rules.md`
- 当前平台申请差异更多由 stage/sourceType + row.status + 弹窗状态驱动：
  - `_DISCOVERY/rules/platform_application_role_permission_matrix_v1.md`

---

## 4) 未确认（Unknown / 下次继续重点）
> 以下不允许脑补；需要你明确口径或给实物。

### 4.1 Confirm Gate 的展示形态
- 弹框只展示“关键字段摘要”还是还要展示“原始输入大段文本/备注”（未冻结）。

### 4.2 摘要字段的展示规则
- 摘要字段是否需要支持“合并显示/格式化”（例如地址合并成一行、联系人+电话一行）（未冻结）。

### 4.3 Gate 触发时机细节
- 是在校验前弹，还是校验后弹（未冻结；通常成熟做法是校验通过后再弹，避免用户确认了又被校验打回）。

### 4.4 placeholder 分支的处理
- 对 “开卡申请/申请核查/申请复用” placeholder：
  - 已确认：按钮可保留，点了提示“开发中/占位”
  - 但占位提示的统一文案/交互未冻结。

---

## 5) 下次继续需要的实物（最省沟通版）
1) 一个最典型的“提交确认”示例：你希望在什么按钮上弹、展示哪些字段（列表即可）。
2) 你希望 Confirm Gate 弹框的示意截图/草图（可用文字描述也行）。
3) Warning Gate 除平台申请外，未来可能涉及的规则类别（重复、黑名单、超阈值等）的清单（可后补）。

---

## 6) 下次续聊的切入点（避免重复劳动）
- 先把 Gate 接到平台申请“最终提交/通过”按钮上，复刻现有重复提醒弹窗（Warning Gate）并补上 Confirm Gate（若需要）。
- 再把 Gate 扩展到工单/其他申请入口的最终提交按钮。
- 后续再考虑是否覆盖“保存草稿/取消离开”等非最终动作（如有强需求）。
