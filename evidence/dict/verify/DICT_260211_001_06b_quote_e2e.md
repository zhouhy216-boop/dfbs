# DICT-260211-001-06.b Quote expenseType e2e verification

**Ticket:** DICT-260211-001-06.b — Seed quote_expense_type + migrate Quote item expenseType end-to-end (immediate effect + historical label stability).

**Purpose:** UI story to verify snapshot display and immediate effect of dict changes.

---

## Build

- **Backend:** `backend/dfbs-app/mvnw.cmd -q compile -DskipTests` — PASS
- **Frontend:** New/changed files pass lint; full build not run (existing TS errors elsewhere).

---

## UI verification story

### 1) Create quote item with type => shows label

- Open Quote list, open or create a draft quote, go to 详情.
- Add a明细行 (Add Line): choose 类型 e.g. 维修费 (REPAIR), fill 数量/单价, save.
- **Expected:** The items table shows 类型 column with the label (e.g. 维修费). Backend has stored expense_type and expense_type_label_snapshot at save time.

### 2) Rename/disable dict item in admin => old quote item display unchanged (snapshot)

- In 字典类型, open type 报价明细类型 (quote_expense_type), go to 字典项管理.
- Rename the item that was used (e.g. 维修费 → 维修费（旧）) or disable it. Save.
- Return to the Quote 详情 and look at the same quote’s 明细 table.
- **Expected:** The **existing** line still shows the **original** label (e.g. 维修费). Display uses expenseTypeLabelSnapshot; it does not change when the dict is updated.

### 3) Add a new quote item after rename/disable => options reflect change immediately

- On the same Quote 详情, add another 明细行.
- **Expected:** The 类型 dropdown shows the **new** labels (e.g. 维修费（旧） if renamed). If an item was disabled, it no longer appears in the dropdown (enabled-only fetch). New record saved will get the new snapshot.

### 4) (Optional) Edit existing item and save => snapshot updates on edit

- Edit the **old** line (the one that still showed 维修费): change 数量 or 单价 only, or also change 类型 to another value, then save.
- **Expected:** After save, the line’s 类型 display updates to the current snapshot for the (possibly new) selected value. Acceptable as “new edit” captures current label.

---

## Summary

- **1:** New item shows label from dict at save time (snapshot stored).
- **2:** Old record display unchanged after dict rename/disable (uses snapshot).
- **3:** New item options and new snapshot reflect current dict (immediate effect).
- **4:** Edit and save updates snapshot to current label.

---

## Evidence file path

`evidence/dict/verify/DICT_260211_001_06b_quote_e2e.md`
