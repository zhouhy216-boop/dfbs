# ACCTPERM Step-03 — 角色模板 UX 改版 证据与用户验证指南

**Parent:** ACCTPERM-260211-001-03  
**Audience:** CEO / 初学者  
**Purpose:** 说明 Step-03 交付内容：**仅用中文名称 + 可选描述创建角色**（不手动输入 key）、**roleKey 自动生成且默认隐藏**、**克隆**、**启用/停用**、**保存后生效 + 还原**；非 allowlist 管理员仍可改名称/启用/描述且保存时**不会清空权限**。本文档支持**仅通过 UI** 完成验证。

---

## 一、核心 UX 承诺

- **不手动输入 key**：在「账号与权限」→ **角色模板** Tab 内，新建角色弹窗**只有**「名称（必填）」「描述（选填）」「启用」；**没有**角色 key 输入框，key 由后端自动生成。
- **roleKey 默认隐藏、不可编辑**：列表中仅展示**名称**与启用状态；**不展示**内部 key。需要排查问题时，可勾选 **「显示内部Key」**（位于列表上方，与「显示全部（含停用）」旁），勾选后列表中显示每行的 roleKey；**默认不勾选**，日常使用无需看到 key。
- **保存后生效、还原恢复**：右侧详情中修改名称、描述、启用或权限勾选后，需点击 **「保存」** 才写入后端；**「还原」** 恢复为上次保存的状态（名称/描述/启用/权限一致）。

---

## 二、前置条件

- **入口**：「系统 → 账号与权限」→ **角色模板** Tab（需 Admin 或 Super-admin）。
- **权限树**：仅 allowlist 用户可加载权限树并勾选权限；**非 allowlist** 管理员仍可进入本 Tab，可新建角色（仅名称/描述/启用）、编辑名称/启用/描述、克隆/删除，保存时**会带上当前已保存的权限键**，不会误清空权限。

---

## 三、UI 验证清单（≤12 条）

1. **新建角色 — 无 key 输入**：点击「新建角色」，弹窗中仅有「名称（必填）」「描述（选填）」「启用」；**无**「角色 key」或类似输入框；填写名称后点击「创建」，应成功并自动选中新角色。
2. **新建后 key 自动生成**：创建成功后，在列表中不显示 key；勾选「显示内部Key」后，新角色行应显示形如 `acctperm_yyyyMMdd_xxxxxx` 的 key。
3. **列表默认不显示 key**：角色列表默认只显示**名称**与「已启用/已停用」标签；不勾选「显示内部Key」时，整列无 key 展示。
4. **显示内部Key 开关**：列表上方有「显示内部Key」复选框，**默认不勾选**；勾选后列表中每行显示 roleKey；取消勾选后 key 再次隐藏。
5. **克隆**：某角色行操作中有「克隆」；点击后应提示成功，新角色出现在列表中，名称为**原名称 + "-副本"**，状态为**已停用**；新角色被自动选中，右侧权限与源角色一致。
6. **启用/停用**：选中角色后，右侧「启用」开关可切换；修改后点击「保存」生效；或通过「编辑」弹窗快速改名称与启用后保存。
7. **描述编辑**：选中角色后，右侧有「描述（选填）」输入框；修改描述后点击「保存」生效；「还原」恢复为上次保存的描述。
8. **保存与还原**：修改名称、描述、启用或权限勾选后，「保存」可点；点击后提示「已保存」，列表与详情与后端一致；再次修改后点击「还原」，名称/描述/启用/权限恢复为上次保存状态。
9. **非 allowlist 无权限树**：使用非 allowlist 的 Admin 账号进入角色模板 Tab，应显示「无权限查看权限树（需超级管理员）」；仍可新建角色（名称/描述/启用）、编辑名称/启用/描述、克隆、删除；保存时不会清空该角色已有权限（后端收到当前 permissionKeys）。
10. **旧入口仍可用**：**/admin/roles-permissions**（角色与权限）仍保留，可仍显示 roleKey 输入等；Step-03 仅改「账号与权限」内角色模板 Tab 的 UX，旧页行为可保持不变。
11. **平台/工单等 RBAC 未变**：角色模板的改版不影响平台管理、工单、effective-keys、账号覆盖等既有 RBAC 鉴权与菜单/按钮隐藏逻辑。
12. **回归**：账号 Tab 的创建账号/启用/停用/重置密码/分配模板、权限树 Tab（allowlist）等 Step-01/02 功能均未因 Step-03 改变。

---

## 四、回归说明

- **旧页 /admin/roles-permissions**：保留且可继续使用；若该页仍显示 roleKey 输入，属预期（本步仅改新入口「账号与权限」→ 角色模板）。
- **RBAC 执行**：平台管理、工单、effective-keys、账号覆盖的「移除优先」等逻辑未改动；仅角色模板的创建/展示/编辑/克隆 UX 变化，接口保持向后兼容。

---

## 五、常见注意点

- **前端构建报错**：若 `npm run build` 因**其他文件**的 TypeScript 报错失败，与 Step-03 的角色模板验证**无冲突**；可用 Admin 账号登录后进入「账号与权限」→ 角色模板 Tab，按上述清单在浏览器中逐条验证。
- **权限树仅 allowlist**：非 allowlist 管理员在角色模板 Tab 内看不到权限树勾选，但可正常使用名称/描述/启用/克隆；保存时不会清空权限，因前端会提交当前已保存的 permissionKeys。

---

## 六、CEO 一句话验证要点

1. **日常不碰 key**：在新入口「账号与权限」→ 角色模板中，新建角色只需填**名称**（和可选描述、启用），**无需也不可**输入 key；需要看 key 时勾选「显示内部Key」即可。
2. **克隆与保存/还原**：可对任意角色点「克隆」得到带「-副本」且停用的新角色；改名称/描述/启用/权限后点「保存」生效，点「还原」恢复上次保存状态。
3. **旧页与 RBAC 不变**：原来的「角色与权限」页面仍在；平台、工单等权限逻辑未因本步改版而改变。
