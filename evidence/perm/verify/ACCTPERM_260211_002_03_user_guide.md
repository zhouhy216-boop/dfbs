# ACCTPERM Step-002-03 — 默认密码管理 证据与用户验证指南

**Parent:** ACCTPERM-260211-002-03  
**Audience:** CEO / 初学者  
**Purpose:** 说明 Step-002-03 交付内容：管理员可在「账号与权限」页面**修改系统默认密码**；UI/API **不返回明文**；修改**持久化到 DB**，重启后仍生效；新默认密码**统一**用于：新建账号初始化、重置密码（留空时）、legacy 登录（password_hash 为 NULL 时）。本文档支持通过 UI 与接口行为完成验证。

---

## 一、前置条件

- **权限**：仅 **admin 或 super-admin** 可访问「系统 → 账号与权限」及默认密码相关接口（GET/PUT）；非 admin 访问会 403。
- **入口**：系统菜单 **「系统」→「账号与权限」**；页面顶部（Tabs 上方）有「默认密码」卡片。
- **密码策略**：新默认密码**至少 6 位**；前端与后端均校验，不足时提示且不保存。

---

## 二、UI 验证清单（≤12 条）

1. **默认密码卡片可见**：以 admin 或 super-admin 进入「账号与权限」后，页面顶部可见「默认密码」卡片；展示「已配置：是/否」、最近修改时间（若有）、修改人（用户 ID，若有），以及说明文案。
2. **说明文案**：卡片内提示：此默认密码将用于【新建账号】与【重置密码（留空）】以及【legacy 登录】；保存后生效。
3. **修改默认密码按钮**：点击「修改默认密码」打开弹窗；弹窗内为两个密码输入框（新默认密码、确认），均为密码类型，**不展示当前明文**。
4. **前端校验**：新密码少于 6 位时，点击保存应提示「默认密码至少 6 位」或类似，且不发起请求。
5. **确认一致校验**：两次输入不一致时，应提示「两次输入不一致」或类似，且不发起请求。
6. **保存成功**：输入合法且一致后保存，应成功；弹窗关闭，卡片状态刷新为「已配置：是」，并显示最近修改时间与修改人；成功提示（如「已保存」）。
7. **无明文展示**：接口与 UI 在任何地方**不返回、不展示**当前或历史默认密码明文；状态接口仅返回 configured、updatedAt、updatedByUserId。
8. **新建账号使用新默认密码**：修改默认密码后，在「账号」Tab 中新建账号（绑定人员）；该账号首次登录应使用**新**默认密码成功登录。
9. **重置密码（留空）使用新默认密码**：对某账号执行「重置密码」且新密码留空；该账号再次登录应使用**新**默认密码成功登录。
10. **Legacy 登录使用新默认密码**：若存在 password_hash 为 NULL 的账号（legacy），修改默认密码后，该账号使用**新**默认密码应能登录；使用旧默认密码应 401。
11. **重启持久化（可选）**：修改默认密码后重启应用；再次打开「默认密码」卡片，应仍为「已配置：是」且修改时间/修改人不变；新建账号与重置（留空）、legacy 登录仍使用该默认密码。
12. **403 与错误处理**：非 admin 调用相关接口应 403；前端应展示「无权限」；后端校验失败（如长度不足）返回友好错误信息，前端展示对应提示。

---

## 三、审计说明

- **操作类型**：`DEFAULT_PASSWORD_CHANGED`（TARGET_SYSTEM）。
- **审计内容**：仅记录「修改」事件；**note 中仅含密码长度**（如 `length=N`），**不含明文**，符合安全要求。

---

## 四、CEO 一句话验证要点

1. **可改、不可见**：在「账号与权限」页面顶部可修改默认密码；界面与接口从不展示明文，仅展示「已配置」及修改时间/修改人。
2. **一处修改、处处生效**：修改后，新建账号、重置密码（留空）、legacy 登录（无 password_hash）均使用新默认密码；重启后仍生效（DB 持久化）。
3. **策略与门控**：默认密码至少 6 位；仅 admin/super-admin 可访问；审计只记长度不记明文。

---

**Build/test status:** 文档仅作证据与验证说明；构建/测试可标为「未执行」或以当前仓库后端编译及前端构建结果为准。
